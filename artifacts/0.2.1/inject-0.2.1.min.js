/*
Inject (c) 2011 Jakob Heuser [https://github.com/jakobo/inject] Apache Software License 2.0
lscache (c) 2011 Pamela Fox [https://github.com/pamelafox/lscache] Apache Software License 2.0
Porthole (c) 2011 Ternary Labs [https://github.com/ternarylabs/porthole] MIT License
*/

(function(){var d,y,B,C,f,n,D,E,F,k,h,G,q,H,I,J,K,L,M,A,r,s,l,t,N,u,v,j,O,P,Q,R,S,T,U,z,o,p;n=this;v=!1;p=h=null;D=0;r=[];o={};t={};l={};y={};z={};k={};f={fileExpiration:1440};M=/.*?\.js$/;J=/^https?:\/\//;K=/^(.*?)(\/.*|$)/;O=/require[\s]*\([\s]*(?:"|')([\w\\/\.\:]+?)(?:'|")[\s]*\)/gm;P=/^(.+?)[\s](.+?)[\s](.+?)[\s]([\w\W]+)$/m;U=function(a){return o=a};q=function(a){return t[a]||!1};R=function(a,b){return t[a]?void 0:t[a]=b};L=function(a){return h!=null&&h[a]!=null};G=function(a,b){var c;c="FILEDB1"+
a;h||(h={});return h[a]&&h[a].length?b(!0,h[a]):(c=s.get(c))&&typeof c==="string"&&c.length?(h[a]=c,b(!0,h[a])):b(!1,null)};Q=function(a,b){var c;c="FILEDB1"+a;if(!L(a))return h[a]=b,s.set(c,b,f.fileExpiration)};C=function(a){var b,c;a==null&&(a=1);c="FILEDB"+a;for(b in localStorage)b.indexOf(c)!==-1&&s.remove(b);if(a===1)return h={}};F=function(){return"txn_"+D++};E=function(){var a,b,c,g,e;c=f!=null?(b=f.xd)!=null?b.xhr:void 0:void 0;b=f!=null?(e=f.xd)!=null?e.inject:void 0:void 0;if(!c)throw Error("Configuration requires xd.remote to be defined");
if(!b)throw Error("Configuration requires xd.local to be defined");g=function(a){return a=a.replace(J,"").replace(K,"$1")};try{a=document.createElement('<iframe name="injectProxy"/>')}catch(V){a=document.createElement("iframe")}a.name="injectProxy";a.src=c+"#xhr";a.style.width=a.style.height="1px";a.style.right=a.style.bottom="0px";a.style.position="absolute";a.id="injectProxy";document.body.insertBefore(a,document.body.firstChild);p=new d.WindowProxy(f.xd.xhr+"#xhr","injectProxy");return p.addEventListener(function(a){var b,
c;if(g(a.origin)===g(f.xd.xhr))if(a.data==="READY"){p.postMessage("READYREADY");v=!1;for(b=0,c=r.length;b<c;b++)a=r[b],a()}else return a=a.data.match(P),u(a[1],a[2],a[3],a[4])})};H=function(a){var b,c;c=function(){};c={before:c,after:c};if(!o[a])return c;a=o[a];for(b in c)a[b]&&(c[b]=a[b]);return c};N=function(a){var b,c,g,e;e=a;b=f.path||"";if(l[a])return l[a];if(o[a]&&(c=o[a],typeof c==="string"&&(e=c),typeof c==="object"&&c.path&&(typeof c.path==="function"&&(g=c.path(e),g!==!1&&(e=g)),typeof c.path===
"string")))e=c.path;typeof b==="function"&&(g=b(e),g!==!1&&(e=g));if(e.indexOf("http")===0||e.indexOf("https")===0)return l[a]=e,l[a];if(e.indexOf("/")!==0&&typeof b==="undefined")throw Error("Path must be defined");e.indexOf("/")!==0&&typeof b==="string"&&(e=""+f.path+e);M.test(e)||(e=""+e+".js");l[a]=e;return l[a]};A=function(a,b){var c,g,e,d,i,w;d=F();e={};for(i=0,w=a.length;i<w;i++)c=a[i],e[c]=N(c);z[d]=a;y[d]=b;i=[];for(c in e)g=e[c],k[g]||(k[g]={txns:[],loading:!1}),q(c)&&(e[c]=q(c)),i.push(G(g,
function(a,b){k[g].txns.push(d);if(a&&typeof b==="string"&&b.length)return u(d,c,g,b);else if(!k[g].loading)return k[g].loading=!0,f.xd!=null?S(d,c,g,u):T(d,c,g,u)}));return i};u=function(a,b,c,g){var e,d,f,w,x;d=H(b);a={};for(e in d)f=d[e],a[e]=f.toString().match(/.*?\{([\w\W]*)\}/m)[1];e='with (window) {\n  (function() {\n    var module = {}, exports = {}, require = __INJECT_NS__.require, exe = null;\n    module.id = "__MODULE_ID__";\n    module.uri = "__MODULE_URI__";\n    module.exports = exports;\n    exe = function(module, exports, require) {\n      __POINTCUT_BEFORE__'.replace(/__MODULE_ID__/g,
b).replace(/__MODULE_URI__/g,c).replace(/__INJECT_NS__/g,"Inject").replace(/__POINTCUT_BEFORE__/g,a.before);a="    __POINTCUT_AFTER__\n  };\n  exe.call(module, module, exports, require);\n  return module.exports;\n})();\n}".replace(/__POINTCUT_AFTER__/g,a.after);w=""+e+"\n"+g+"\n"+a+"\n//@ sourceURL="+c;for(e=[];O.exec(g);)e.push(RegExp.$1);x=function(){var a,e,d,f,i;try{a=n.eval(w)}catch(x){throw x;}R(b,a);Q(c,g);k[c].loading=!1;f=k[c].txns;i=[];for(e=0,d=f.length;e<d;e++)a=f[e],i.push(B(a));return i};
return e.length>0?A(e,function(){return x()}):x()};B=function(a){var b,c,g,e,d,f;c=!0;b=y[a];e=[];f=z[a];for(a=0,d=f.length;a<d;a++)if(g=f[a],g=q(g),g===!1?c=!1:e.push(g),!c)break;if(c)return b.call(n,e)};T=function(a,b,c,d){var e;e=I();e.open("GET",c);e.onreadystatechange=function(){if(e.readyState===4&&e.status===200)return d.call(n,a,b,c,e.responseText)};return e.send(null)};S=function(a,b,c){return p.postMessage(""+a+" "+b+" "+c)};I=function(){var a;a=!1;if(typeof XMLHttpRequest!=="undefined")try{a=
new XMLHttpRequest}catch(b){a=!1}if(!a&&typeof window.createRequest!=="undefined")try{a=new window.createRequest}catch(c){a=!1}if(!a)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(d){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){a=!1}}if(!a)throw Error("Could not create an xmlHttpRequest Object");return a};j=function(a){var b;b=q(a);if(b===!1)throw Error(""+a+" not loaded");return b};j.ensure=function(a,b){var c;f.xd!=null&&!p&&!v&&(E(),v=!0);c=function(){return A(a,function(){var a,c;c=
{};a={};c.exports=a;return b.call(n,j,c,a)})};return v?r.push(c):c()};j.setModuleRoot=function(a){typeof a==="string"&&a.lastIndexOf("/")!==a.length&&(a=""+a+"/");return f.path=a};j.setExpires=function(a){return f.fileExpiration=a};j.setCrossDomain=function(a,b){f.xd={};f.xd.inject=a;return f.xd.xhr=b};j.clearCache=function(a){return C(a)};j.manifest=function(a){return U(a)};j.run=function(){return"bar"};n.require=j;n.Inject={require:j,debug:{fileRegistry:h,loadQueue:r,userModules:o,moduleRegistry:t,
modulePathRegistry:l,callbackRegistry:y,txnRegistry:z}};d=null;d="undefined"==typeof d||!d?{}:d;d={trace:function(){},error:function(a){try{console.error("Porthole: "+a)}catch(b){}},WindowProxy:function(){}};d.WindowProxy.prototype={postMessage:function(){},addEventListener:function(){},removeEventListener:function(){}};d.WindowProxyLegacy=function(a,b){void 0===b&&(b="");this.targetWindowName=b;this.eventListeners=[];this.origin=window.location.protocol+"//"+window.location.host;null!==a?(this.proxyIFrameName=
this.targetWindowName+"ProxyIFrame",this.proxyIFrameLocation=a,this.proxyIFrameElement=this.createIFrameProxy()):this.proxyIFrameElement=null};d.WindowProxyLegacy.prototype={getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},createIFrameProxy:function(){var a=document.createElement("iframe");a.setAttribute("id",this.proxyIFrameName);a.setAttribute("name",this.proxyIFrameName);a.setAttribute("src",this.proxyIFrameLocation);a.setAttribute("frameBorder",
"1");a.setAttribute("scrolling","auto");a.setAttribute("width",30);a.setAttribute("height",30);a.setAttribute("style","position: absolute; left: -100px; top:0px;");a.style.setAttribute&&a.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;");document.body.appendChild(a);return a},postMessage:function(a,b){void 0===b&&(b="*");null===this.proxyIFrameElement?d.error("Can't send message because no proxy url was passed in the constructor"):(sourceWindowName=window.name,this.proxyIFrameElement.setAttribute("src",
this.proxyIFrameLocation+"#"+a+"&sourceOrigin="+escape(this.getOrigin())+"&targetOrigin="+escape(b)+"&sourceWindowName="+sourceWindowName+"&targetWindowName="+this.targetWindowName),this.proxyIFrameElement.height=50<this.proxyIFrameElement.height?50:100)},addEventListener:function(a){this.eventListeners.push(a);return a},removeEventListener:function(a){try{this.eventListeners.splice(this.eventListeners.indexOf(a),1)}catch(b){this.eventListeners=[],d.error(b)}},dispatchEvent:function(a){for(var b=
0;b<this.eventListeners.length;b++)try{this.eventListeners[b](a)}catch(c){d.error("Exception trying to call back listener: "+c)}}};d.WindowProxyHTML5=function(a,b){void 0===b&&(b="");this.targetWindowName=b};d.WindowProxyHTML5.prototype={postMessage:function(a,b){void 0===b&&(b="*");targetWindow=""===this.targetWindowName?top:parent.frames[this.targetWindowName];targetWindow.postMessage(a,b)},addEventListener:function(a){window.addEventListener("message",a,!1);return a},removeEventListener:function(a){window.removeEventListener("message",
a,!1)},dispatchEvent:function(a){var b=document.createEvent("MessageEvent");b.initMessageEvent("message",!0,!0,a.data,a.origin,1,window,null);window.dispatchEvent(b)}};"function"!=typeof window.postMessage?(d.trace("Using legacy browser support"),d.WindowProxy=d.WindowProxyLegacy,d.WindowProxy.prototype=d.WindowProxyLegacy.prototype):(d.trace("Using built-in browser support"),d.WindowProxy=d.WindowProxyHTML5,d.WindowProxy.prototype=d.WindowProxyHTML5.prototype);d.WindowProxy.splitMessageParameters=
function(a){if("undefined"==typeof a||null===a)return null;var b=[],a=a.split(/&/),c;for(c in a){var d=a[c].split("=");b[d[0]]="undefined"==typeof d[1]?"":d[1]}return b};d.MessageEvent=function(a,b,c){this.data=a;this.origin=b;this.source=c};d.WindowProxyDispatcher={forwardMessageEvent:function(a){a=document.location.hash;if(0<a.length){a=a.substr(1);m=d.WindowProxyDispatcher.parseMessage(a);targetWindow=""===m.targetWindowName?top:parent.frames[m.targetWindowName];var b=d.WindowProxyDispatcher.findWindowProxyObjectInWindow(targetWindow,
m.sourceWindowName);b?b.origin==m.targetOrigin||"*"==m.targetOrigin?(a=new d.MessageEvent(m.data,m.sourceOrigin,b),b.dispatchEvent(a)):d.error("Target origin "+b.origin+" does not match desired target of "+m.targetOrigin):d.error("Could not find window proxy object on the target window")}},parseMessage:function(a){if("undefined"==typeof a||null===a)return null;params=d.WindowProxy.splitMessageParameters(a);var b={targetOrigin:"",sourceOrigin:"",sourceWindowName:"",data:""};b.targetOrigin=unescape(params.targetOrigin);
b.sourceOrigin=unescape(params.sourceOrigin);b.sourceWindowName=unescape(params.sourceWindowName);b.targetWindowName=unescape(params.targetWindowName);a=a.split(/&/);if(3<a.length)a.pop(),a.pop(),a.pop(),a.pop(),b.data=a.join("&");return b},findWindowProxyObjectInWindow:function(a,b){a.RuntimeObject&&(a=a.RuntimeObject());if(a)for(var c in a)try{if(null!==a[c]&&"object"==typeof a[c]&&a[c]instanceof a.Porthole.WindowProxy&&a[c].getTargetWindowName()==b)return a[c]}catch(d){}return null},start:function(){window.addEventListener?
window.addEventListener("resize",d.WindowProxyDispatcher.forwardMessageEvent,!1):document.body.attachEvent?window.attachEvent("onresize",d.WindowProxyDispatcher.forwardMessageEvent):d.error("Can't attach resize event")}};s=null;s=function(){function a(){return Math.floor((new Date).getTime()/6E4)}function b(b,e,f){function i(){try{localStorage.setItem(b+d,a()),0<f?(localStorage.setItem(b+c,a()+f),localStorage.setItem(b,e)):0>f||0===f?(localStorage.removeItem(b+d),localStorage.removeItem(b+c),localStorage.removeItem(b)):
localStorage.setItem(b,e)}catch(o){if("QUOTA_EXCEEDED_ERR"===o.name||"NS_ERROR_DOM_QUOTA_REACHED"==o.name){if(0===k.length&&!j)return localStorage.removeItem(b+d),localStorage.removeItem(b+c),localStorage.removeItem(b),!1;j&&(j=!1);if(!h){for(var p=0,q=localStorage.length;p<q;p++)if(l=localStorage.key(p),-1<l.indexOf(d)){var r=l.split(d)[0];k.push({key:r,touched:parseInt(localStorage[l],10)})}k.sort(function(a,b){return a.touched-b.touched})}if(n=k.shift())localStorage.removeItem(n.key+d),localStorage.removeItem(n.key+
c),localStorage.removeItem(n.key);i()}}}var h=!1,j=!0,k=[],l,n;i()}var c="-EXP",d="-LRU",e;try{e=!!localStorage.getItem}catch(f){e=!1}var i=null!=window.JSON;return{set:function(a,c,d){if(e){if("string"!=typeof c){if(!i)return;try{c=JSON.stringify(c)}catch(f){return}}b(a,c,d)}},get:function(b){function f(a){if(i)try{return JSON.parse(localStorage.getItem(a))}catch(b){return localStorage.getItem(a)}else return localStorage.getItem(a)}if(!e)return null;if(localStorage.getItem(b+c)){var h=parseInt(localStorage.getItem(b+
c),10);if(a()>=h)localStorage.removeItem(b),localStorage.removeItem(b+c),localStorage.removeItem(b+d);else return localStorage.setItem(b+d,a()),f(b)}else if(localStorage.getItem(b))return localStorage.setItem(b+d,a()),f(b);return null},remove:function(a){if(!e)return null;localStorage.removeItem(a);localStorage.removeItem(a+c);localStorage.removeItem(a+d)}}}()}).call(this);

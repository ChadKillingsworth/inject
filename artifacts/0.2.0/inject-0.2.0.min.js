/*
Inject (c) 2011 Jakob Heuser [https://github.com/jakobo/inject] Apache Software License 2.0
lscache (c) 2011 Pamela Fox [https://github.com/pamelafox/lscache] Apache Software License 2.0
Porthole (c) 2011 Ternary Labs [https://github.com/ternarylabs/porthole] MIT License
*/

(function(){var d,w,z,A,h,n,B,C,D,k,g,E,q,F,G,H,I,J,K,y,r,s,j,t,L,u,v,i,M,N,O,P,Q,R,S,x,o,p;n=this;v=!1;p=g=null;B=0;r=[];o={};t={};j={};w={};x={};k={};h={fileExpiration:1440};K=/.*?\.js$/;H=/^https?:\/\//;I=/^(.*?)(\/.*|$)/;M=/require[\s]*\([\s]*(?:"|')([\w\\/\.\:]+?)(?:'|")[\s]*\)/gm;N=/^(.+?)[\s](.+?)[\s](.+?)[\s]([\w\W]+)$/m;S=function(a){return o=a};q=function(a){return t[a]||!1};P=function(a,b){return t[a]?void 0:t[a]=b};J=function(a){return g!=null&&g[a]!=null};E=function(a,b){var c;c="FILEDB1"+
a;g||(g={});return g[a]&&g[a].length?b(!0,g[a]):(c=s.get(c))&&typeof c==="string"&&c.length?(g[a]=c,b(!0,g[a])):b(!1,null)};O=function(a,b){var c;c="FILEDB1"+a;if(!J(a))return g[a]=b,s.set(c,b,h.fileExpiration)};A=function(a){var b,c;a==null&&(a=1);c="FILEDB"+a;for(b in localStorage)b.indexOf(c)!==-1&&s.remove(b);if(a===1)return g={}};D=function(){return"txn_"+B++};C=function(){var a,b,c,f,e;c=h!=null?(b=h.xd)!=null?b.xhr:void 0:void 0;b=h!=null?(e=h.xd)!=null?e.inject:void 0:void 0;if(!c)throw Error("Configuration requires xd.remote to be defined");
if(!b)throw Error("Configuration requires xd.local to be defined");f=function(a){return a=a.replace(H,"").replace(I,"$1")};try{a=document.createElement('<iframe name="injectProxy"/>')}catch(T){a=document.createElement("iframe")}a.name="injectProxy";a.src=c+"#xhr";a.style.width=a.style.height="1px";a.style.right=a.style.bottom="0px";a.style.position="absolute";a.id="injectProxy";document.body.insertBefore(a,document.body.firstChild);p=new d.WindowProxy(h.xd.xhr+"#xhr","injectProxy");return p.addEventListener(function(a){var b,
c;if(f(a.origin)===f(h.xd.xhr))if(a.data==="READY"){p.postMessage("READYREADY");v=!1;for(b=0,c=r.length;b<c;b++)a=r[b],a()}else return a=a.data.match(N),u(a[1],a[2],a[3],a[4])})};F=function(a){var b,c;c=function(){};c={before:c,after:c};if(!o[a])return c;a=o[a];for(b in c)a[b]&&(c[b]=a[b]);return c};L=function(a){var b,c,f,e;e=a;b=h.path||"";if(j[a])return j[a];if(o[a]&&(c=o[a],typeof c==="string"&&(e=c),typeof c==="object"&&c.path&&(typeof c.path==="function"&&(f=c.path(e),f!==!1&&(e=f)),typeof c.path===
"string")))e=c.path;typeof b==="function"&&(f=b(e),f!==!1&&(e=f));if(e.indexOf("http")===0||e.indexOf("https")===0)return j[a]=e,j[a];if(e.indexOf("/")!==0&&typeof b==="undefined")throw Error("Path must be defined");e.indexOf("/")!==0&&typeof b==="string"&&(e=""+h.path+e);K.test(e)||(e=""+e+".js");j[a]=e;return j[a]};y=function(a,b){var c,f,e,d,l,g;d=D();e={};for(l=0,g=a.length;l<g;l++)c=a[l],e[c]=L(c);x[d]=a;w[d]=b;l=[];for(c in e)f=e[c],k[f]||(k[f]={txns:[],loading:!1}),q(c)&&(e[c]=q(c)),l.push(E(f,
function(a,b){k[f].txns.push(d);if(a&&typeof b==="string"&&b.length)return u(d,c,f,b);else if(!k[f].loading)return k[f].loading=!0,h.xd!=null?Q(d,c,f,u):R(d,c,f,u)}));return l};u=function(a,b,c,f){var e,d,l,h,g;d=F(b);a={};for(e in d)l=d[e],a[e]=l.toString().match(/.*?\{([\w\W]*)\}/m)[1];e='with (window) {\n  (function() {\n    var module = {}, exports = {}, require = __INJECT_NS__.require, exe = null;\n    module.id = "__MODULE_ID__";\n    module.uri = "__MODULE_URI__";\n    module.exports = exports;\n    exe = function(module, exports, require) {\n      __POINTCUT_BEFORE__'.replace(/__MODULE_ID__/g,
b).replace(/__MODULE_URI__/g,c).replace(/__INJECT_NS__/g,"Inject").replace(/__POINTCUT_BEFORE__/g,a.before);a="    __POINTCUT_AFTER__\n  };\n  exe.call(module, module, exports, require);\n  return module.exports;\n})();\n}".replace(/__POINTCUT_AFTER__/g,a.after);h=""+e+"\n"+f+"\n"+a+"\n//@ sourceURL="+c;for(e=[];M.exec(f);)e.push(RegExp.$1);g=function(){var a,e,d,g,l;try{a=n.eval(h)}catch(i){throw i;}P(b,a);O(c,f);k[c].loading=!1;g=k[c].txns;l=[];for(e=0,d=g.length;e<d;e++)a=g[e],l.push(z(a));return l};
return e.length>0?y(e,function(){return g()}):g()};z=function(a){var b,c,f,e,d,g;c=!0;b=w[a];e=[];g=x[a];for(a=0,d=g.length;a<d;a++)if(f=g[a],f=q(f),f===!1?c=!1:e.push(f),!c)break;if(c)return b.call(n,e)};R=function(a,b,c,f){var e;e=G();e.open("GET",c);e.onreadystatechange=function(){if(e.readyState===4&&e.status===200)return f.call(n,a,b,c,e.responseText)};return e.send(null)};Q=function(a,b,c){return p.postMessage(""+a+" "+b+" "+c)};G=function(){var a;a=!1;if(typeof XMLHttpRequest!=="undefined")try{a=
new XMLHttpRequest}catch(b){a=!1}if(!a&&typeof window.createRequest!=="undefined")try{a=new window.createRequest}catch(c){a=!1}if(!a)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){a=!1}}if(!a)throw Error("Could not create an xmlHttpRequest Object");return a};i=function(a){var b;b=q(a);if(b===!1)throw Error(""+a+" not loaded");return b};i.ensure=function(a,b){var c;h.xd!=null&&!p&&!v&&(C(),v=!0);c=function(){return y(a,function(){var a,c;c=
{};a={};c.exports=a;return b.call(n,i,c,a)})};return v?r.push(c):c()};i.setModuleRoot=function(a){typeof a==="string"&&a.lastIndexOf("/")!==a.length&&(a=""+a+"/");return h.path=a};i.setExpires=function(a){return h.fileExpiration=a};i.setCrossDomain=function(a,b){h.xd={};h.xd.inject=a;return h.xd.xhr=b};i.clearCache=function(a){return A(a)};i.manifest=function(a){return S(a)};i.run=function(){return"bar"};n.require=i;n.Inject={require:i,debug:{fileRegistry:g,loadQueue:r,userModules:o,moduleRegistry:t,
modulePathRegistry:j,callbackRegistry:w,txnRegistry:x}};d=null;d=typeof d=="undefined"||!d?{}:d;d={trace:function(){},error:function(a){try{console.error("Porthole: "+a)}catch(b){}},WindowProxy:function(){}};d.WindowProxy.prototype={postMessage:function(){},addEventListener:function(){},removeEventListener:function(){}};d.WindowProxyLegacy=function(a,b){b===void 0&&(b="");this.targetWindowName=b;this.eventListeners=[];this.origin=window.location.protocol+"//"+window.location.host;a!==null?(this.proxyIFrameName=
this.targetWindowName+"ProxyIFrame",this.proxyIFrameLocation=a,this.proxyIFrameElement=this.createIFrameProxy()):this.proxyIFrameElement=null};d.WindowProxyLegacy.prototype={getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},createIFrameProxy:function(){var a=document.createElement("iframe");a.setAttribute("id",this.proxyIFrameName);a.setAttribute("name",this.proxyIFrameName);a.setAttribute("src",this.proxyIFrameLocation);a.setAttribute("frameBorder",
"1");a.setAttribute("scrolling","auto");a.setAttribute("width",30);a.setAttribute("height",30);a.setAttribute("style","position: absolute; left: -100px; top:0px;");a.style.setAttribute&&a.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;");document.body.appendChild(a);return a},postMessage:function(a,b){b===void 0&&(b="*");this.proxyIFrameElement===null?d.error("Can't send message because no proxy url was passed in the constructor"):(sourceWindowName=window.name,this.proxyIFrameElement.setAttribute("src",
this.proxyIFrameLocation+"#"+a+"&sourceOrigin="+escape(this.getOrigin())+"&targetOrigin="+escape(b)+"&sourceWindowName="+sourceWindowName+"&targetWindowName="+this.targetWindowName),this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100)},addEventListener:function(a){this.eventListeners.push(a);return a},removeEventListener:function(a){try{this.eventListeners.splice(this.eventListeners.indexOf(a),1)}catch(b){this.eventListeners=[],d.error(b)}},dispatchEvent:function(a){for(var b=
0;b<this.eventListeners.length;b++)try{this.eventListeners[b](a)}catch(c){d.error("Exception trying to call back listener: "+c)}}};d.WindowProxyHTML5=function(a,b){b===void 0&&(b="");this.targetWindowName=b};d.WindowProxyHTML5.prototype={postMessage:function(a,b){b===void 0&&(b="*");targetWindow=this.targetWindowName===""?top:parent.frames[this.targetWindowName];targetWindow.postMessage(a,b)},addEventListener:function(a){window.addEventListener("message",a,!1);return a},removeEventListener:function(a){window.removeEventListener("message",
a,!1)},dispatchEvent:function(a){var b=document.createEvent("MessageEvent");b.initMessageEvent("message",!0,!0,a.data,a.origin,1,window,null);window.dispatchEvent(b)}};typeof window.postMessage!="function"?(d.trace("Using legacy browser support"),d.WindowProxy=d.WindowProxyLegacy,d.WindowProxy.prototype=d.WindowProxyLegacy.prototype):(d.trace("Using built-in browser support"),d.WindowProxy=d.WindowProxyHTML5,d.WindowProxy.prototype=d.WindowProxyHTML5.prototype);d.WindowProxy.splitMessageParameters=
function(a){if(typeof a=="undefined"||a===null)return null;var b=[],a=a.split(/&/),c;for(c in a){var d=a[c].split("=");b[d[0]]=typeof d[1]=="undefined"?"":d[1]}return b};d.MessageEvent=function(a,b,c){this.data=a;this.origin=b;this.source=c};d.WindowProxyDispatcher={forwardMessageEvent:function(a){a=document.location.hash;if(a.length>0){a=a.substr(1);m=d.WindowProxyDispatcher.parseMessage(a);targetWindow=m.targetWindowName===""?top:parent.frames[m.targetWindowName];var b=d.WindowProxyDispatcher.findWindowProxyObjectInWindow(targetWindow,
m.sourceWindowName);b?b.origin==m.targetOrigin||m.targetOrigin=="*"?(a=new d.MessageEvent(m.data,m.sourceOrigin,b),b.dispatchEvent(a)):d.error("Target origin "+b.origin+" does not match desired target of "+m.targetOrigin):d.error("Could not find window proxy object on the target window")}},parseMessage:function(a){if(typeof a=="undefined"||a===null)return null;params=d.WindowProxy.splitMessageParameters(a);var b={targetOrigin:"",sourceOrigin:"",sourceWindowName:"",data:""};b.targetOrigin=unescape(params.targetOrigin);
b.sourceOrigin=unescape(params.sourceOrigin);b.sourceWindowName=unescape(params.sourceWindowName);b.targetWindowName=unescape(params.targetWindowName);a=a.split(/&/);if(a.length>3)a.pop(),a.pop(),a.pop(),a.pop(),b.data=a.join("&");return b},findWindowProxyObjectInWindow:function(a,b){a.RuntimeObject&&(a=a.RuntimeObject());if(a)for(var c in a)try{if(a[c]!==null&&typeof a[c]=="object"&&a[c]instanceof a.Porthole.WindowProxy&&a[c].getTargetWindowName()==b)return a[c]}catch(d){}return null},start:function(){window.addEventListener?
window.addEventListener("resize",d.WindowProxyDispatcher.forwardMessageEvent,!1):document.body.attachEvent?window.attachEvent("onresize",d.WindowProxyDispatcher.forwardMessageEvent):d.error("Can't attach resize event")}};s=null;s=function(){var a;try{a=!!localStorage.getItem}catch(b){a=!1}var c=window.JSON!=null;return{set:function(b,e,d){if(a){if(typeof e!="string"){if(!c)return;try{e=JSON.stringify(e)}catch(g){return}}try{localStorage.setItem(b,e)}catch(h){if(h.name==="QUOTA_EXCEEDED_ERR"||h.name==
"NS_ERROR_DOM_QUOTA_REACHED"){for(var i,k=[],j=0;j<localStorage.length;j++)if(i=localStorage.key(j),i.indexOf("-cacheexpiration")>-1){var n=i.split("-cacheexpiration")[0];k.push({key:n,expiration:parseInt(localStorage[i],10)})}k.sort(function(a,b){return a.expiration-b.expiration});j=0;for(i=Math.min(30,k.length);j<i;j++)localStorage.removeItem(k[j].key),localStorage.removeItem(k[j].key+"-cacheexpiration");localStorage.setItem(b,e)}else return}d?localStorage.setItem(b+"-cacheexpiration",Math.floor((new Date).getTime()/
6E4)+d):localStorage.removeItem(b+"-cacheexpiration")}},get:function(b){function e(a){if(c)try{return JSON.parse(localStorage.getItem(a))}catch(b){return localStorage.getItem(a)}else return localStorage.getItem(a)}if(!a)return null;if(localStorage.getItem(b+"-cacheexpiration")){var d=parseInt(localStorage.getItem(b+"-cacheexpiration"),10);if(Math.floor((new Date).getTime()/6E4)>=d)localStorage.removeItem(b),localStorage.removeItem(b+"-cacheexpiration");else return e(b)}else if(localStorage.getItem(b))return e(b);
return null},remove:function(b){if(!a)return null;localStorage.removeItem(b);localStorage.removeItem(b+"-cacheexpiration")}}}()}).call(this);
